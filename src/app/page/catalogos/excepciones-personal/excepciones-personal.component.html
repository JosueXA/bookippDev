<mat-card class="mat-elevation-z8" id="mainMatCard">
    <mat-card-header>
        <div style="width: 100%;">
            <mat-card-title> Configuración Personal </mat-card-title>
        </div>
        <div style="text-align: right; width: 100%;">
            <mat-icon class="iconosBookipp" svgIcon="iconCasa1" (click)="irAAgenda()" style="cursor: pointer; height: auto; position: relative;"></mat-icon>
            <a style="cursor: pointer; color: #20c4e6; top: -6px; position: relative;" (click)="irAAgenda()">{{'consultaExcepcionesTranslate.inicio' | translate}}</a>
            <mat-icon class="iconosBookipp" svgIcon="iconFlecha1DerechaPeque" style="position: relative;"></mat-icon>
            <a style="color: #20c4e6; top: -6px; position: relative;">{{'consultaExcepcionesTranslate.excepciones' | translate}}</a>&nbsp;
        </div>
    </mat-card-header>
    <mat-divider></mat-divider>

    <mat-card-content class="py-5">
        <!-- Pestañas -->
        <mat-tab-group dynamicHeight="true" mat-align-tabs="center" preserveContent="true" #tabGroup>
            <div id="myTabContent" class="tab-content">
                <!-- Pestaña Comisiones -->
                <mat-tab id="liComisiones" label="Comisiones" style="width: 50%;">
                    <div id="divComisiones" class="p-3" style="width: 100%;">
                        <div style="min-height: 350px;">
                            <div class="row">
                                <!-- Información General -->
                                <div class="col-lg-7" id="infoPaquetes">
                                    <!-- Nueva Categoría -->
                                    <div class="col-lg-12 py-2" style="min-height: 53px; display: flex; align-items: center;">
                                        <label class="col-3 control-label"   *ngIf="this.habilitarBtnNuevaCategoria">
                                            {{'consultaExcepcionesTranslate.nuevaCategoria' | translate}}
                                        </label>
                                        <div class="col-7" *ngIf="this.habilitarBtnNuevaCategoria">
                                            <mat-icon class="iconosBookipp" svgIcon="iconAgregar" (click)="inicializarComisiones()" style="position: relative; top: 1px; width: auto; height: 32px; cursor: pointer;"></mat-icon>
                                        </div>
                                    </div>

                                    <!-- Categoría -->
                                    <div class="row col-lg-12 py-2">
                                        <label class="col-lg-3 control-label" style="padding-top: 7px;">
                                            {{'consultaExcepcionesTranslate.nombreCategoria' | translate}}
                                        </label>
                                        <div class="col-lg-7">
                                            <input tabindex="5" id="txtDescripcion" class="form-control borderAzul ng-pristine ng-valid" 
                                                maxlength="100" type="text" [(ngModel)]="comisiones.nombre" style="width: 100%;">
                                        </div>
                                    </div>
        
                                    <!-- Servicios -->
                                    <div class="row col-lg-12 py-2">
                                        <label class="col-lg-3 control-label" style="padding-top: 6px;">
                                            {{'consultaExcepcionesTranslate.servicios' | translate}}
                                        </label>
                                        <div class="col-6 modAnchoDdl">
                                            <ng-select id="ddlServicio" style="width: 100%;" [multiple]="true" appendTo="#mainMatCard" [searchable]="true"
                                                [(ngModel)]="comisiones.servicios" [clearable]="true"
                                                placeholder="{{'personalTranslate.serviciosG'| translate}}"
                                                [items]="comisiones.dataServicios" bindLabel="nombre" bindValue="idServicio">
                                            </ng-select>
                                        </div>
                                        <div class="col-3" style="display: flex; align-items: center;">
                                            <mat-slide-toggle id="chckServicios" [(ngModel)]="banderaChckServicios"></mat-slide-toggle>
                                            <label style="margin-left:4px">{{'consultaExcepcionesTranslate.todos' | translate}}</label>
                                        </div>
                                    </div>

                                    <!-- Productos -->
                                    <div class="row col-lg-12 py-2">
                                        <label class="col-lg-3 control-label">
                                            {{'consultaExcepcionesTranslate.productos'| translate}}
                                        </label>
                                        <div class="col-6 modAnchoDdl">
                                            <ng-select id="ddlProductos" style="width: 100%;" [multiple]="true" appendTo="#mainMatCard" [searchable]="true"
                                                [(ngModel)]="comisiones.productos" [clearable]="true"
                                                placeholder="{{'consultaExcepcionesTranslate.ddlProductos' | translate}}"
                                                [items]="comisiones.dataProductos" bindLabel="producto" bindValue="idInventarioPresentacion">
                                            </ng-select>
                                        </div>
                                        <div class="col-3" style="display: flex; align-items: center;">
                                            <mat-slide-toggle id="chckProductos" [(ngModel)]="banderaChckProductos"></mat-slide-toggle>
                                            <label style="margin-left:4px">{{'consultaExcepcionesTranslate.todos' | translate}}</label>
                                        </div>
                                    </div>

                                    <!-- Paquetes -->
                                    <div class="row col-lg-12 py-2">
                                        <label class="col-lg-3 control-label">
                                            Paquetes
                                        </label>
                                        <div class="col-6 modAnchoDdl">
                                            <ng-select id="ddlPaquetes" style="width: 100%;" [multiple]="true" appendTo="#mainMatCard" [searchable]="true"
                                                [(ngModel)]="comisiones.paquetes" [clearable]="true"
                                                placeholder="Seleccione los paquetes"
                                                [items]="comisiones.dataPaquetes" bindLabel="nombre" bindValue="idPaqueteSucursal">
                                            </ng-select>
                                        </div>
                                        <div class="col-3" style="display: flex; align-items: center;">
                                            <mat-slide-toggle id="chckPaquetes" [(ngModel)]="banderaChckPaquetes"></mat-slide-toggle>
                                            <label style="margin-left:4px">{{'consultaExcepcionesTranslate.todos' | translate}}</label>
                                        </div>
                                    </div>
                                    
                                    <!-- Tipo Comisión -->
                                    <div class="row col-lg-12 py-2">
                                        <label class="col-lg-3 control-label">
                                            Tipo comisión
                                        </label>
                                        <div class="col-lg-4" >
                                            <ng-select id="ddlTipoComision" style="width: 100%;" [multiple]="false" appendTo="#mainMatCard" [searchable]="true"
                                                [(ngModel)]="comisiones.tipoComision" [clearable]="false"
                                                placeholder="{{'consultaExcepcionesTranslate.ddlTipoComision' | translate}}"
                                                [items]="comisiones.dataTipoComision" bindLabel="nombre" bindValue="idComisionTipo">
                                            </ng-select>
                                        </div>
                                    </div>
                                    
                                    <!-- Comisiones -->
                                    <div class="row col-lg-12 py-2">
                                        <label class="col-lg-3 control-label">
                                            {{'consultaExcepcionesTranslate.comisiones'| translate}}
                                        </label>
                                        <div class="col-lg-4">
                                            <input id="txtFactor" class="form-control borderAzul"
                                                style="text-align:right;" type="text" maxlength="9" currencyMask
                                                [(ngModel)]="comisiones.factor"
                                                [options]="{ allowNegative: false, prefix: '', nullable: true, inputMode: 1 }" />
                                            <span *ngIf="comisiones.tipoComision == 1" id="fijo" style="position:relative; right:-11px; top:-27px;">$</span>
                                            <span *ngIf="comisiones.tipoComision == 2" id="porcentual" style="position:relative; right:-11px; top:-27px;">%</span>
                                        </div>
                                    </div>

                                    <!-- Boton de guardado -->
                                    <div class="col-lg-12" style="text-align: center; margin-top: 40px; margin-bottom: 40px">
                                        <div class="row">
                                            <div class="col-lg-4"></div>
                                            <div class="col-lg-4">
                                                <button id="btnGuardarCat" (click)="guardarCategoria()" class="buttonEstiloBlanco">
                                                    {{'consultaExcepcionesTranslate.guardar' | translate}}
                                                </button>
                                            </div>
                                            <div class="col-lg-4"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Listado de Paquetes-->
                                <div class="col-lg-5" id="listadoPaquetes">
                                    <div class="col-lg-12" id="inputBusqueda">
                                        <div class="row" style="margin-left: 10.5%; margin-top:8px; padding-bottom: 10px;">
                                            <div class="col-lg-12" style="border: 0px solid;">
                                                <span class="moverIconoBusqueda iconoBusqueda" style=" margin-left: 12px; color: #337dc0; font-size: 18px; margin-right:275px;">
                                                    <mat-icon class="iconosBookipp" svgIcon="iconBuscar" style="position: relative; top: 10px; width: 22px; height: 22px; cursor: pointer;"></mat-icon>
                                                </span>
                                                <input id="inputNombres" style="height: 30px; width:230px; padding-left: 35px; padding-right:initial;" type="text" 
                                                    [(ngModel)]="inputBusquedaPaquete" class="form-control borderAzul" (ngModelChange)="busquedaPaquete()"
                                                    placeholder="{{'consultaClienteTranslate.buscar' | translate}}"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-12 mb-2" id="divServicios" style="margin-left: 10.5%; max-width: 460px;">
                                        <ul class="col-lg-12" id="navlist" style="max-height: 500px; overflow-y:auto; padding: 0px;">
                                            <li class="row" *ngFor="let i of dataCategorias" style="padding-top: 10px; text-align: center; font-size:14px; width: 99%;" >
                                                <div class="col-1" style="display: flex; height: auto;">
                                                    <mat-icon class="iconosBookipp" svgIcon="iconCruz" id="borrar{{i.idComisionCategoria}}" (click)="borrarCategoria(i.idComisionCategoria)" style="width: 15px; cursor: pointer;"></mat-icon>
                                                </div>
                                                <div class="{{i.claseColor}} col-1" id="div{{i.idComisionCategoria}}" (click)="editarCategoria(i.idComisionCategoria)" style="cursor: pointer; border-radius: 25px; text-align: center; padding-top: 6px; min-height: 26px; margin-left: 5px">
                                                </div>
                                                <div class="row col-9" style="display: flex;">
                                                    <label class="col-lg-8" id="lbl{{i.idComisionCategoria}}"style="overflow: hidden; white-space: nowrap; cursor: pointer; text-overflow: ellipsis; cursor: pointer; text-align: left; margin-top: 6px; font-size: 13px"
                                                        (click)="editarCategoria(i.idComisionCategoria)"> {{i.nombre}} 
                                                    </label>
                                                </div>
                                                <br/>
                                            </li>
                                        </ul>
                                  </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </mat-tab>

                <!-- Pestaña Excepciones -->
                <mat-tab id="liExcepciones" label="Excepciones" style="width: 50%;">
                    <div id="screenGrid" style="width: 100%; padding-top:10px; height: 750px;">
                        <div style="margin: auto">
                            <div class="modal-body">
                                <div style="width: auto; height: auto; position: relative;padding-top:10px">
                                    <!-- Sección del Calendario, Botón y Búsqueda -->
                                    <div class="row">
                                        <!--Se agrega el Calendario en Personal Seccion Excepciones-->
                                        <div class="row page_seccion_campo" style="margin-bottom:1%; margin-top:15px">
                                            <div class="col-lg-4" id ="CalendarioCliente">
                                                <div style="padding-left: 15px;">
                                                    <mat-icon class="iconosBookipp" svgIcon="iconCalendarioEditar" style="position: absolute; margin: 8px 0px 0px 30px;"></mat-icon>
                                                    <input type="text"
                                                        ngxDaterangepickerMd
                                                        class="form-control borderAzul"
                                                        style="cursor: pointer; height: 40px; width: 350px; padding-left: 90px;border-radius: 1.5rem;"
                                                        [(ngModel)]="personalexcepciones.fechas"
                                                        (ngModelChange)="personalexcepciones_cambioFecha($event)"
                                                        [showCustomRangeLabel]="true"
                                                        [alwaysShowCalendars]="true"
                                                        [ranges]="this.ranges"
                                                        [linkedCalendars]="true"
                                                        [isInvalidDate] = "isInvalidDate"
                                                        [showClearButton]="false"
                                                        [locale] = "this.locale"
                                                        [showDropdowns]="true"
                                                        placeholder="DD/MM/YYYY - DD/MM/YYYY"
                                                    />
                                                    <mat-icon class="iconosBookipp" svgIcon="iconFlechaAbajoPeque" style="position: absolute; margin: -30px 0px 0px 300px;"></mat-icon>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Botón y Filtro de busqueda -->
                                        <div class="row col-lg-12" style="margin: 0.3%">
                                            <div class="col-3" style="height: 50px;">
                                                <button (click)="crearNuevaExcepcion()" class="buttonEstiloBlanco">{{'consultaExcepcionesTranslate.nuevo' | translate}}</button>
                                            </div>
                                            <div class="col-lg-6 ocultarDiv"></div>
                                            <div class="col-3 pt-1 modAnchoDdl " style="padding-left: 0; padding-bottom: 2%; float: right;">
                                                <span style="position: absolute; margin-left: 10px; color: #337dc0; font-size: 18px;">
                                                    <mat-icon class="iconosBookipp" svgIcon="iconBuscar" style="position: relative; width: 22px; height: 22px; cursor: pointer;"></mat-icon>
                                                </span>
                                                <input id="inputPersonalExcepciones" placeholder="Buscar" style="height: 30px; padding-left: 35px; width: 93%;" type="text" [(ngModel)]="PersonalExcepcionesBusqueda" class="form-control borderAzul" (ngModelChange)="BusquedaPersonalExcepciones()" />
                                            </div> 
                                        </div>
                                    </div>

                                    <!-- Tabla de Excepciones por personal -->
                                    <mat-card-content style="margin-top: 10px; min-height: 300px; margin-left: 15px; overflow: auto;">
                                        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8" style="width: 97%; min-width: 750px; border: solid 1px #a7b3b8;">
                                            <ng-container matColumnDef="idExcepcion">
                                                <th mat-header-cell *matHeaderCellDef style="text-align: center; width: 223px;">
                                                    {{'consultaExcepcionesTranslate.acciones' | translate}}
                                                </th>
                                                <td mat-cell *matCellDef="let element" style="text-align: center;">
                                                    <mat-icon class="iconosBookipp" svgIcon="iconEditar1" (click)="editarExcepcion(element)" style="cursor: pointer; width: 25px;"></mat-icon>
                                                    <mat-icon class="iconosBookipp" svgIcon="iconBasura" (click)="modalBorrar(element)" style="cursor: pointer; width: 25px;"></mat-icon>
                                                    <div style="width: 25px; display: inline-block;">
                                                        <mat-icon class="iconosBookipp" svgIcon="iconInfoCirculo" *ngIf="element.nCitas != 0" ngbPopover="{{'consultaExcepcionesTranslate.existenCitas' | translate}}" style="cursor: pointer;"></mat-icon>
                                                    </div>
                                                </td>
                                            </ng-container>                      
                        
                                            <ng-container matColumnDef="nombres">
                                                <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 628px;">
                                                    Personal
                                                </th>
                                                <td mat-cell *matCellDef="let element"> {{element.nombres}} </td>
                                            </ng-container>

                                            <ng-container matColumnDef="descripcion">
                                                <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 221px;">
                                                    descripcion
                                                </th>
                                                <td mat-cell *matCellDef="let element"> {{element.descripcion}} </td>
                                            </ng-container>
                                
                                            <ng-container matColumnDef="fechaInicio">
                                                <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 213px;">
                                                    fechaInicio
                                                </th>
                                                <td mat-cell *matCellDef="let element" style="text-align: center;"> {{element.fechaInicio}} </td>
                                            </ng-container>
                                
                                            <ng-container matColumnDef="fechaFin">
                                                <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 213px;">
                                                    fechaFin
                                                </th>
                                                <td mat-cell *matCellDef="let element" style="text-align: center;"> {{element.fechaFin}} </td>
                                            </ng-container>
                                            
                                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>                    
                                        </table>  
                                    </mat-card-content>

                                    <mat-paginator [length]="100"
                                        [pageSize]="10"
                                        [pageSizeOptions]="[5, 10, 25, 100]"
                                        aria-label="Select page">
                                    </mat-paginator>
                                </div>
                            </div>
                        </div>
                    </div>
                </mat-tab>
            </div>
        </mat-tab-group>
    </mat-card-content>
</mat-card>

<!-- Modal Alert-->
<div id="modal-alert" tabindex="-1" role="dialog" aria-hidden="true" class="modal fade modal-alert">
    <div class="modal-dialog">
        <div class="modal-content" style="margin: 0 auto; font-weight: 400; width: 600px;">
            <div class="modal-body" id="mensaje1">
            </div>
            <div class="modal-footer">
                <div class="col-lg-3">
                    <button type="button" data-bs-dismiss="modal" class="buttonEstiloBlanco" style="height: auto;">
                        {{'consultaExcepcionesTranslate.aceptar' | translate}}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Modal Confirm-->
<div id="modal-confirm" tabindex="2" role="dialog" aria-hidden="true" class="modal fade modal-confirm">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <div class="col-lg-3">
                    <button type="button" data-bs-dismiss="modal" class="buttonEstiloBlanco" style="height: auto;">
                        {{'consultaExcepcionesTranslate.cancelar' | translate}}
                    </button>
                </div>
                <div class="col-lg-3">
                    <button type="button" data-bs-dismiss="modal" class="buttonEstiloBlanco" (click)="borrarExcepcion();" style="height: auto;">
                        {{'consultaExcepcionesTranslate.si' | translate}}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Error -->
<div id="modal-alertError" tabindex="-1" role="dialog" aria-hidden="true" class="modal fade modal-alertError">
    <div class="modal-dialog">
        <div class="modal-content" style="margin: 100px auto auto auto; font-weight: 400; max-width: 450px; min-height: 100px; background: #dce6ea;">
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <div class="col-lg-3">
                    <button type="button" data-bs-dismiss="modal" class="buttonEstiloBlanco" style="height: auto;">
                        {{'clienteTranslate.aceptar' | translate}}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
